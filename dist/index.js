var A=Object.create;var S=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty;var L=(t,e,r,c)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of T(e))!v.call(t,o)&&o!==r&&S(t,o,{get:()=>e[o],enumerable:!(c=O(e,o))||c.enumerable});return t};var l=(t,e,r)=>(r=t!=null?A(q(t)):{},L(e||!t||!t.__esModule?S(r,"default",{value:t,enumerable:!0}):r,t));var h=l(require("axios")),p=require("crypto"),d=l(require("fs")),m=l(require("@emailjs/browser")),y=(process.env.HOME||process.env.HOMEPATH||process.env.USERPROFILE)+"/.credentials/",u=y+"spotify_access_token.json";function J(t){try{d.default.mkdirSync(y)}catch(e){if(e.code!="EEXIST")throw e}d.default.writeFile(u,JSON.stringify(t),e=>{if(e)throw e;console.log("Token stored to "+u)})}function P(){return new Promise((t,e)=>{d.default.readFile(u,async function(r,c){if(r){let o=await f();t(o)}else{let o=JSON.parse(c);t(o)}})})}async function f(){let t="https://accounts.spotify.com/api/token",e=await h.default.post(t,{client_id:"d16860988beb42ccaabc4b1c3709c15a",client_secret:"d66c2867fe754ebd8870f2e8bc31b42f",grant_type:"client_credentials"},{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return J(e.data),e.data}async function b(t){return new Promise(async(e,r)=>{t=encodeURIComponent(t);let c=await P();console.log(t);let o=`https://api.spotify.com/v1/search?q=${t}&type=track`;h.default.get(o,{headers:{Authorization:`Bearer ${c.access_token}`}}).then(async n=>{if(n.status===401){console.log("Access Token Expired"),console.log("Requesting new access token"),await f(),e([]);return}let s=n.data.tracks.items,a=[];for(let g of s){let E=g.artists.map(x=>x.name),I={title:g.name,artist:E.toLocaleString().replaceAll(",",", "),id:(0,p.randomUUID)(),image:g.album.images[0].url,date:Date.now(),href:g.href,previewLink:g.preview_url,spotifyLink:g.uri};a.push(I)}e(a)}).catch(async n=>{if(n.response.status===401){console.log("Access Token Expired"),console.log("Requesting new access token"),await f(),e([]);return}if(n.response.status===429){console.log("The app has exceeded its rate limits."),m.send("song_begger_mail_service","song_beggar_contact",{email:"songbeggar@server.com",username:"Song Beggar Server",message:n.response.data.error.toString()}).then(a=>{console.log("light","Operation Successful, "+a.text)},a=>{console.log("danger",`Operation Failed 
 `+a.text)}).catch(a=>{console.log("danger","Operation Failed"),console.log(a)});let s={title:"Error",artist:n.message,id:(0,p.randomUUID)(),image:"",date:Date.now(),href:"",previewLink:"",spotifyLink:""};e([s]);return}console.log("An Error Occurred"),m.send("song_begger_mail_service","song_beggar_contact",{email:"songbeggar@server.com",username:"Song Beggar Server",message:n.response.data.error.toString()}).then(s=>{console.log("light","Operation Successful, "+s.text)},s=>{console.log("danger",`Operation Failed 
 `+s.text)}).catch(s=>{console.log("danger","Operation Failed"),console.log(s)}),e([])})})}var w=l(require("@emailjs/browser")),R=require("express"),F=require("firebase"),j=require("cors"),_=require("body-parser"),B=require("multer"),D=B();require("firebase/firestore");var z={apiKey:"AIzaSyCyGJpuGlrzMjV0kIaMht4673xiKN9gEgs",authDomain:"beggar-dc861.firebaseapp.com",projectId:"beggar-dc861",storageBucket:"beggar-dc861.appspot.com",messagingSenderId:"146917155340",databaseURL:"https://beggar-dc861-default-rtdb.firebaseio.com",appId:"1:146917155340:web:8db9ca5043d55b666c0429",measurementId:"G-G8ZZQQH572"};w.init("xhgni5tAASWOcxiAS");var G=F.initializeApp(z);async function H(t){return await b(t.body.keywords)}var i=R(),k=3001;i.use(_.urlencoded({extended:!1}));i.use(_.json());i.use(D.array());i.use(j());i.get("/",(t,e)=>{e.send("Song Beggar")});i.post("/",(t,e)=>{t.body.keywords==""&&e.send(!1),H(t).then(r=>{e.send(r)}).catch(r=>{e.send(r)})});i.listen(k,()=>{console.log(`Song Beggar Server, Listening on ${k}`)});
